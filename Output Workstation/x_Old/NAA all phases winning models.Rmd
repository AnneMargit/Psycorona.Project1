---
title: "NAA all phases winning models"
author: "Anne Margit"
date: "10/04/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, set-options, echo=FALSE, cache= FALSE}
options(width=1000)
Sys.getenv('R_MAX_VSIZE')
```

```{r, results = "hide"}
load("data_analyse2_p1.Rdata")
load("data_analyse2_p2.Rdata")
load("data_analyse2_p3.Rdata")
```

This dataset includes:

1. Data from all weekly measurement waves (baseline through wave 11, Time 1 through 12) 
2. Participants who provided at least 3 measurements 
3. Participants who are residents of the country they currently live in
4. Participants who provided info on age
5. Participants who provided info on gender (either male or female)
6. Data from countries with at least 20 participants
7. Pooled age groups
8. Imputed missing emotion scores
9. Combined emotion scores (NAA, NAD, PAA, PAD)
10. An imputed Stringency index (StringencyIndex_imp) 
11. A dummy Str_dummy with 0 = before the peak, 1 = during peak, 2 = after peak
12. A variable indicating the number of days before maximum stringency was reached (DaysMax_p1), during (DaysMax_p2), and after (DaysPhase3)
13.  A variable indicating the number of weeks before maximum stringency was reached (WeeksMax_p1), during (WeeksMax_p2), and after (WeeksPhase3)
14. A variable indicating the date on which maximum Stringency was reached for that country (DateMaxStr) and the max level reached (MaxStr) across the entire measurement period
15. A variable indicating the date on which minimum Stringency was reached for that country (DateMinStr) and the min level reached (MinStr) across the entire measurement period
15. Observations during which there was a second peak are excluded (N=583) 

> My comments are in block quotes such as this. 

```{r, message=F}
library(dplyr)
library(tidyverse)
library(ggpubr)
library(ggplot2)
library(rockchalk)
library(effects)
library(nlme)
library(lattice)
library(broom.mixed)
library(purrr)
```

# Descriptives
**Number of participants per age group**
Phase 1
```{r, message=F, comment=NA}
data_analyse2_p1 %>%
  group_by(Age_new) %>%
  summarise(NAge = n())
```

Phase 2
```{r, message=F, comment=NA}
data_analyse2_p2 %>%
  group_by(Age_new) %>%
  summarise(NAge = n())
```

Phase 3
```{r, message=F, comment=NA}
data_analyse2_p2 %>%
  group_by(Age_new) %>%
  summarise(NAge = n())
```

# Descriptives
**Number of participants per education level**

> 1= Primary education, 2= General secondary education, 3= Vocational education, 4=Higher education, 5=Bachelors degree, 6=Masters degree, 7= PhD degree

Phase 1
```{r, message=F, comment=NA}
data_analyse2_p1$Edu <- as_factor(data_analyse2_p1$Edu)

data_analyse2_p1 %>%
  group_by(Edu) %>%
  summarise(NEdu = n())
```

Phase 2
```{r, message=F, comment=NA}
data_analyse2_p2$Edu <- as_factor(data_analyse2_p2$Edu)

data_analyse2_p2 %>%
  group_by(Edu) %>%
  summarise(NEdu = n())
```

Phase 3
```{r, message=F, comment=NA}
data_analyse2_p3$Edu <- as_factor(data_analyse2_p3$Edu)

data_analyse2_p3 %>%
  group_by(Edu) %>%
  summarise(NEdu = n())
```

# Descriptives
**Number of females and males**

> 0= Male, 1= Female

```{r, message=F, comment=NA}
data_analyse2_p1$Gender <- as_factor(data_analyse2_p1$Gender)

data_analyse2_p1 %>%
  group_by(Gender) %>%
  summarise(NGender = n())
```

Phase 2
```{r, message=F, comment=NA}
data_analyse2_p2$Gender <- as_factor(data_analyse2_p2$Gender)

data_analyse2_p2 %>%
  group_by(Gender) %>%
  summarise(NGender = n())
```

Phase 3
```{r, message=F, comment=NA}
data_analyse2_p3$Gender <- as_factor(data_analyse2_p3$Gender)

data_analyse2_p3 %>%
  group_by(Gender) %>%
  summarise(NGender = n())
```

**Plots**
**Mean NAA against max stringency in WEEKS**
Phase 1
```{r, echo=T, message=F, warning=F}
plot_NAA1 <- ggplot(data_analyse2_p21, aes(x=WeeksMax_p1, y=NAA, group = Age_new, color = Age_new))

plot_NAA1 + stat_summary(fun.y=mean, geom="line", size=1)  + geom_errorbar(stat="summary", fun.data="mean_se", width=0) + scale_colour_discrete(name = "Age", labels = c("18-24", "25-44", "45-64", "65+")) + expand_limits(y=c(1, 5))
```

Phase 2
```{r, echo=T, message=F, warning=F}
plot_NAA2 <- ggplot(data_analyse2_p2, aes(x=WeeksMax_p2, y=NAA, group = Age_new, color = Age_new))

plot_NAA2 + stat_summary(fun.y=mean, geom="line", size=1)  + geom_errorbar(stat="summary", fun.data="mean_se", width=0) + scale_colour_discrete(name = "Age", labels = c("18-24", "25-44", "45-64", "65+")) + expand_limits(y=c(1, 5))
```

Phase 3
```{r, echo=T, message=F, warning=F}
plot_NAA3 <- ggplot(data_analyse2_p3, aes(x=WeeksMax_p3, y=NAA, group = Age_new, color = Age_new))

plot_NAA3 + stat_summary(fun.y=mean, geom="line", size=1)  + geom_errorbar(stat="summary", fun.data="mean_se", width=0) + scale_colour_discrete(name = "Age", labels = c("18-24", "25-44", "45-64", "65+")) + expand_limits(y=c(1, 5))
```

**Mean NAA against max stringency in DAYS**
Phase 1
```{r, echo=T, message=F, warning=F}
plot_NAA1 <- ggplot(data_analyse2_p1, aes(x=DaysMax_p1, y=NAA, group = Age_new, color = Age_new))

plot_NAA1 + stat_summary(fun.y=mean, geom="line", size=1)  + geom_errorbar(stat="summary", fun.data="mean_se", width=0) + scale_colour_discrete(name = "Age", labels = c("18-24", "25-44", "45-64", "65+")) + expand_limits(y=c(1, 5))
```

Phase 2
```{r, echo=T, message=F, warning=F}
plot_NAA2 <- ggplot(data_analyse2_p2, aes(x=DaysMax_p2, y=NAA, group = Age_new, color = Age_new))

plot_NAA2 + stat_summary(fun.y=mean, geom="line", size=1)  + geom_errorbar(stat="summary", fun.data="mean_se", width=0) + scale_colour_discrete(name = "Age", labels = c("18-24", "25-44", "45-64", "65+")) + expand_limits(y=c(1, 5))
```

Phase 3
```{r, echo=T, message=F, warning=F}
plot_NAA3 <- ggplot(data_analyse2_p3, aes(x=DaysPhase3, y=NAA, group = Age_new, color = Age_new))

plot_NAA3 + stat_summary(fun.y=mean, geom="line", size=1)  + geom_errorbar(stat="summary", fun.data="mean_se", width=0) + scale_colour_discrete(name = "Age", labels = c("18-24", "25-44", "45-64", "65+")) + expand_limits(y=c(1, 5))
```




# Phase 1
*Winning model: Random IC for ID and Country with covariates Gender and Education*
```{r, message=F, comment=NA}
model_NAAp1 <- lme(fixed = NAA ~ Gender + Edu + Age_new,
                  random = ~1 | Country/ID, 
                  data = data_analyse2_p1, 
                  na.action = na.omit)

summary(model_NAAp1)
```
```{r, message=F, comment=NA}
coef_NAA = tidy(model_NAAp1, 
               effects = "fixed")
```

*Effect sizes*

**Within person SD and average within person SD of NAA**
```{r, message=F, comment=NA}
ISDs <- data_analyse2_p1 %>% 
  group_by(ID) %>%
  summarize_at(c("NAA"), sd, na.rm=TRUE) %>%
  ungroup()

ISDs_av <- ISDs %>%
  summarize_at(c("NAA"), mean, na.rm=TRUE) %>%
  stack() %>%
  rename(sd=values) 
```

> Effect sizes for intercept and main effect of age = regression coefficient / average ISD of NAA

```{r, message=F, comment=NA}
coef_NAA <- coef_NAA %>%
  mutate(e_size = estimate/0.4122624) %>%
  mutate(across(2:7, round, 4))
         
```


